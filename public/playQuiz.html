<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friend Or Stranger</title>
    <link rel="stylesheet" href="styleQuiz.css">
</head>

<body id="playBody">
    <header></header>
    <main>
        <section class="playLogIn" id="playLogIn">
            <h1 id="welcome">Welcome to their's Game</h1>
            <h3>How well do you know them</h3>

            <div class="logBox">

                <div class="logInput">
                    <p>Enter your name / nickname?</p>
                    <input autocomplete="name" id="name" name="name" required type="text" placeholder="eg. Zack">
                </div>
                <button class="logButton" onclick="StartQuiz()">Start Quiz</button>
            </div>

            <div id="logWarning" class="logWarnOff">
                <p>Warning:</p>
                <p><b id="logWarnText">Use these details to view scoreboard / results</b></p>
            </div>
            <div class="logAbout">
                <p>NB:</p>
                <p><b>This name will be shown on the scoreboard</b></p>
            </div>

            </div>
        </section>
        <section class="playground notReady" id="playground">
            <h2 id="round" class="round">1 of 0</h2>
            <h2 id="roundTopic" class="makerQuestion">Which one do you prefer?</h2>
            <section id="logozSec" class="allLogosBox">
                <div onclick="pick1()" class="logoBox">
                    <p class="logoTittle" id="logoTittle1">Logo Tittle</p>
                    <div class="logoImageBox">
                        <img id="logo1" class="logoImage" src="" alt="logo">
                    </div>
                </div>
                <div onclick="pick2()" class="logoBox">
                    <p class="logoTittle" id="logoTittle2">Logo Tittle</p>
                    <div class="logoImageBox">
                        <img id="logo2" class="logoImage" src="" alt="logo">
                    </div>
                </div>
                <div onclick="pick3()" class="logoBox">
                    <p class="logoTittle" id="logoTittle3">Logo Tittle</p>
                    <div class="logoImageBox">
                        <img id="logo3" class="logoImage" src="" alt="logo">
                    </div>
                </div>
                <div onclick="pick4()" class="logoBox">
                    <p class="logoTittle" id="logoTittle4">Logo Tittle</p>
                    <div class="logoImageBox">
                        <img id="logo4" class="logoImage" src="" alt="logo">
                    </div>
                </div>
                <div onclick="pick5()" class="logoBox">
                    <p class="logoTittle" id="logoTittle5">Logo Tittle</p>
                    <div class="logoImageBox">
                        <img id="logo5" class="logoImage" src="" alt="logo">
                    </div>
                </div>
                <div onclick="pick6()" class="logoBox">
                    <p class="logoTittle" id="logoTittle6">Logo Tittle</p>
                    <div class="logoImageBox">
                        <img id="logo6" class="logoImage" src="" alt="logo">
                    </div>
                </div>
            </section>
        </section>
    </main>
    <footer></footer>
    <style>
        * {
            font-family: arial;
            box-sizing: border-box;
            margin: 0;
        }

        body {
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
        }

        .logBox {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgb(209, 209, 209);
            padding: 1rem;
            border-radius: 0.6rem;
            box-shadow: 0rem 0rem 0.25rem black inset;
        }

        .logInput {
            font-size: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0.5rem;

            input {
                font-size: 1.5rem;
                border-radius: 5rem;
                border: solid rgba(0, 0, 0, 0) 0.1rem;
                padding: 0.3rem 0.7rem;
                margin-top: 0.5rem;
            }
        }

        .logButton {
            font-size: 1.5rem;
            background: limegreen;
            padding: 0.2rem 1.2rem;
            border: solid 0.1rem rgba(0, 0, 0, 0.377);
            box-shadow: 0rem 0rem 0.2rem rgba(0, 0, 0, 0.8);
            margin: 1rem 0 0;
            font-weight: bold;
        }

        .logAbout,
        .logWarnOn {
            margin: 1.5rem;
            display: flex;
            gap: 0.5rem;
            color: rgba(0, 0, 0, 0.7);
            background: rgba(255, 217, 0, 0.63);
            padding: 0.8rem;
            box-shadow: 0rem 0rem 0.2rem black inset;
            max-width: 80vw;
        }

        .logWarnOn {
            background: rgb(255, 100, 100);
            margin: 1rem 0 -0.3rem;
        }

        .logWarnOff {
            display: none;
        }

        input:focus {
            transform: scale(1.1);
        }

        .notReady {
            display: none
        }



        /* LOGOS */
        .makerQuestion {
            text-align: center;
            margin-top: 2rem;
        }

        .allLogosBox {

            display: grid;
            grid-template-columns: 1fr 1fr;




            .logoBox {
                margin: 2%;
                border: solid black 0.1rem;
                border-radius: 0.5rem;
            }

            ;

            .logoTittle {
                font-size: 1.5rem;
                font-weight: bold;
                text-align: center
            }

            ;

            .logoImageBox {
                max-width: 35vw;
                max-height: 30vh;
                aspect-ratio: 1/1;
                display: flex;
                align-items: center;
                justify-content: center;

                img {
                    width: 90%;
                    height: 90%;
                    border-radius: 0.5rem;
                }
            }
        }


        @media (min-width:500px) {
            .allLogosBox {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
    </style>

    <script>

        const Topic = ["animal", "app", "brand", "car", "color", "country", "flower", "food", "club", "game", "hobby", "movie", "music", "sport", "subject", "visit"]

        const Item = { "animal": ["bird", "cat", "dog", "fish", "pig", "snake"], "app": ["facebook", "netflix", "spotify", "tiktok", "whatsapp", "youtube"], "car": ["audi", "bmw", "chevrolet", "mercedes", "toyota", "vw"], "color": ["black", "blue", "green", "pink", "red", "yellow"], "country": ["brazil", "england", "france", "korea", "sa", "usa"], "flower": ["dandelion", "hibiscus", "hydrangea", "lily", "rose", "sunflower"], "food": ["burger", "cake", "icecream", "pie", "pizza", "salad"], "club": ["barcelona", "liverpool", "mancity", "manunited", "psg", "realmadrid"], "hobby": ["cooking", "dancing", "drawing", "gaming", "singing", "sleeping"], "game": ["candycrush", "chess", "cod", "fifa", "ludo", "minecraft"], "movie": ["action", "animation", "comedy", "horror", "romance", "scifi"], "music": ["electronic", "gospel", "hiphop", "reggae", "rnb", "pop"], "sport": ["basketball", "boxing", "criket", "football", "rugby", "tennis"], "subject": ["geography", "history", "math", "physics", "science", "tourism"], "visit": ["amusementpark", "beach", "city", "museum", "park", "zoo"], "brand": ["addidas", "lacoste", "louisvuitton", "nike", "puma", "reebok"] }

        let TopicOder
        let Answers = {}
        let questionText = ""
        let onRound = 1
        let owner = "they"
        let username = "noName"
        let officialTopics = []
        let browseTopic = -1
        let onTopic = "app"
        let score = 0
        let CorrectAns = {}
        let gameData

        /* ###################################################### */
        /* ###################################################### */
        /* ###################################################### */
        /* ###################################################### */
        /* ###################################################### */

        function StartQuiz() {
            const name = document.getElementById("name").value

            if (name == "") {
                document.getElementById("logWarnText").innerText = "Name/Nickname is missing"
                document.getElementById("logWarning").setAttribute("class", "logWarnOn")
                return
            }
            else { document.getElementById("logWarning").setAttribute("class", "logWarnOff") }

            cookieStore.set("username", name)

            async function AskGame() {
                let gameId = window.location.href
                gameId = gameId.split("/", 5)[4]


                const response = await fetch("/quizData", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ gameId }) }).then(res => res.json())

                if (response["state"] == "nogame") {
                    document.getElementById("logWarnText").innerText = "Invaid game link / Game does not exist."
                    document.getElementById("logWarning").setAttribute("class", "logWarnOn")
                    return
                }

                if (response["state"] == "good") {
                    document.getElementById("playLogIn").setAttribute("class", "notReady")
                    document.getElementById("playground").setAttribute("class", "")
                    TopicOder = response["data"]["officialTopics"]
                    owner = response["data"]["name"]

                    CorrectAns = response["data"]["Picks"]

                    NextRound()
                }




            }
            setName()

            AskGame()

        }

        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */
        /* xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx */








        function NextRound() {
            document.getElementById("round").innerText = `${onRound} of 10`

            browseTopic += 1
            /*  if (onRound) {
                 console.log("Done!!!");
                 
 
                 Finished()
             } */

            function SetRoundValues() {
                if (officialTopics.includes(TopicOder[browseTopic])) {
                    SetRoundValues()
                }
                else {
                    onTopic = TopicOder[browseTopic]

                    switch (onTopic) {
                        case "hobby": questionText = `Which hobby does ${owner} like?`
                            break;
                        case `movie`: questionText = `Which movie genre does ${owner} prefer?`
                            break;
                        case `country`: questionText = `Which country would ${owner} visit?`
                            break;
                        case `car`: questionText = `Which car brand does ${owner} prefer?`
                            break;
                        case `subject`: questionText = `Which school subject does ${owner} prefer?`
                            break;
                        case `animal`: questionText = `Which pet does ${owner} prefer?`
                            break;
                        case `visit`: questionText = `Which place would ${owner} visit?`
                            break;
                        default: questionText = `Which ${onTopic} does ${owner} prefer?`
                            break;
                    }


                }
                document.getElementById("roundTopic").innerText = questionText

                 function SetLogos() {
                    for (let index = 1; index < 7; index++) {

                        document.getElementById(`logoTittle${index}`).innerText = TittleFix(Item[onTopic][index - 1])

                        document.getElementById(`logo${index}`).setAttribute("src", ``)

                        document.getElementById(`logo${index}`).setAttribute("src", `../logo/${onTopic}/${Item[onTopic][index - 1]}.png`)

                    }
                }
                SetLogos()

            }

            SetRoundValues()
        }





        function pick1() { picked(1) }
        function pick2() { picked(2) }
        function pick3() { picked(3) }
        function pick4() { picked(4) }
        function pick5() { picked(5) }
        function pick6() { picked(6) }

        function picked(num) {
            Answers[onTopic] = Item[onTopic][num - 1]
            officialTopics.push(onTopic)

            if (onRound < 10) {
                onRound += 1
                NextRound()
            }
            else {
                Finished()
            }

        }


        function TittleFix(word) {

            switch (word) {
                case "sa": return "South Africa"
                case "usa": return "USA"
                case "scifi": return "Sci-Fi"
                case "psg": return "PSG";
                case "manunited": return "Man United"
                case "mancity": return "Man City"
                case "realmadrid": return "Real Madrid"
                case "whatsapp": return "WhatsApp"
                case "youtube": return "YouTube"
                case "tiktok": return "TikTok"
                case "rnb": return "R&B"
                case "hiphop": return "HipHop"
                case "icecream": return "IceCream"
                case "vw": return "VW"
                case "bmw": return "BMW"
                case "amusementpark": return "Amusement Park"
                case "candycrush": return "Candy Crush"
                case "cod": return "Call Of Duty"
                case "louisvuitton": return "Louis Vuitton"
                case "": return ""
                default:
                    break;
            }

            return word.slice(0, 1).toUpperCase() + word.slice(1)
        }

        async function setName() {
            username = await cookieStore.get("username").then(res => res["value"])

        }

        async function Finished() {
            function ScoreCalc() {

                gameData["officialTopics"].map(ans => {
                    if (Answers[ans] == gameData["Picks"][ans]) {
                        score += 1
                    }

                });


                return score
            }

            score = ScoreCalc()

            document.getElementById("playBody").innerHTML="<h1>Loading...</h1>"

            const response = await fetch("/played", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ "name": username, score, gameId: gameData["gameId"] }) }).then(res=>res.json())

            /* if (response.status != 200) {
                console.log("Error Occured");
                return
            } */

            if(response["state"]=="good"){
                window.location.href=`/scores/${gameData["gameId"]}`
            } 




        }

        async function EarlyPrep() {
            let gameId = window.location.href.split("/", 5)[4]

            const res = await fetch("/quizData", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ gameId }) }).then(res => res.json())

            if (res["state"] == "good") {
                const greet = `Weclome to ${res["data"]["name"]}'s game`
                document.getElementById("welcome").innerText = greet
                gameData = res["data"]
            }
            else {
                const greet = "Something went wrong! :("
                document.getElementById("welcome").innerText = greet
            }

        }
        EarlyPrep()

    </script>
</body>

</html>